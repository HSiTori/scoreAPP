<html>
<head>
 <link rel="stylesheet" type="text/css" href="css/bootstrap.css"/>
 <script type="text/javascript" src="js/jquery-3.1.1.min.js"></script>
 <script src="https://code.jquery.com/jquery-2.1.4.js"></script>
 <script type="text/javascript" src="js/bootstrap.min.js"></script>
 <script src="js/ForerunnerDB.js"></script>
 <script src="js/main.js"></script>
 <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
 <meta charset="UTF-8">
</head>  
<body>
  
<div class="container">
<div class="row"> 
   
<!--上方列表-->
<nav class="navbar navbar-inverse">
<div class="container-fluid">
<div id="container-headbox">
 <div class="navbar-header">
   <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  </div>
<div class="collapse navbar-collapse navbar-collapse-center" id="myNavbar">   
  <ul class="nav navbar-nav">
    <div class="btn-group btn-group-justified">
    <a href="mainScore.html" class="btn btn-link">首頁</a>
    <a href="addScore.html" class="btn btn-link">新增成績</a>
    <a href="searchdate.html" class="btn btn-link">日期查詢</a>
  </div>    
  </ul> 
  <ul class="nav navbar-nav navbar-right">
    <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">其他(≧▽≦)<span class="caret"></span></a>
  <ul class="dropdown-menu">
   <div class="container">
   <div class="row"> 
    <div class="col-xs-6"><a href="subjectSearch.html">各科目成績</a></div>
    <div class="col-xs-6"><a href="#">各曜日成績</a></div>
    <div class="col-xs-6"><a href="#">不及格列表</a></div>
    <div class="col-xs-6"><a href="test.html">時間&分數比例計算</a></div>
   </div>
   </div> 
  </ul>
    </li>
  </ul>
 </div>
</div> 
</div>
</nav>  

<!--選擇條件-->
  <div id="select">
  <div style="text-align:center;" id="subject">
  </div>
  <div style="text-align:center; margin-bottom:20px; margin-top:10px;">
    其他科目搜尋:<input name="sub-search" id="other" style="text-align:center;" placeholder="Enter a subject." class="form-control">
  </div>
  <div style="text-align:center;">
   <button onclick="searchSubDetail();">查詢</button>  
  </div>    
  </div>
 
<!--搜尋表格-->
  <div class="col-xs-12" id="subSearchlist">
  <div id="messageTop" style="text-align:center;">
  </div> 
  <table id="subSearchtable" class="table table-striped" style="">
    <thead>
     <tr>
        <th>項目</th>
        <th>分數</th>
        <th>日期</th>
        <th>詳細</th>
        <th>操作</th>
     </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
  <div id="messageButton" style="text-align:center;">
  </div> 
</div>  
  
<!--"更多"modal-->   
   <div id="alert-information" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
<div class="modal-dialog modal-lg" role="document">
   <div class="modal-content" style="margin-top: 60%;">
     <div class="modal-header">
       <h4 style="text-align:center;" >詳細資料</h4> 
       <p id='information' style="text-align:center;"></p>
       <div style="text-align:center;">
       <button type="button" class="btn btn-default" data-dismiss="modal">Close</button> 
       </div>
     </div>  
   </div> 
</div>
</div>  
 
 
<!--編輯資料-->  
<div id="changemodal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
<div class="modal-dialog modal-lg" role="document">
   <div class="modal-content" style="margin-top: 20px;">
     <div class="modal-header" style="text-align:center;">
      <div id="modal-head-right" style="text-align:center;">
        <p><b>更改成功!!</b></p>
        <button type='button' class='btn btn-default' data-dismiss='modal'>Close</button>
      </div>
      <div id="modal-head-wrong" style="text-align:center;">
        <div class='alert alert-danger'><strong>Danger!</strong><p>請輸入必填資料!</p></div>
      </div>
      <div id="most" style="text-align:center;">
       <h2 style="text-align:center;" ><b>更改資料</b></h2> 
       <p id='changedata' style="text-align:center;"></p>
     <div class="select-body" style="text-align:center;">
     <div class="container" style="text-align:center;">
          <div style="text-align:center;">
          <a class="clean" id="first-subject" for="input"></a><br> 
             <select class="form-control" id="subject">
             </select>
          <div id="subject-other-div" style="text-align:center; margin-bottom:0px; margin-top:5px;">
           <input id="subject-other" type="text" class="form-control" style="text-align:center;" placeholder="Enter a Subject">
          </div> 
          <small id="joke" class="form-text text-muted text-danger">*必填</small><br>
          </div>
          <div style="text-align:center;">
          <a class="clean" id="first-score" for="input"></a><br>
          <input id="score-change" type="number" class="form-control" style="text-align:center;" placeholder="Score">
          <small id="joke" class="form-text text-muted text-danger">*必填</small><br>
          </div>
          <div style="text-align:center;">
          <a class="clean" id="first-date" for="input"></a><br>
          <input id="date-change" type="date" class="form-control" style="text-align:center;" placeholder="Date"><br>
          </div>
          <div style="text-align:center;">
          <a class="clean" id="first-other" for="input"></a><br>
          <textarea class="form-control" rows="3" id="other-change" style="text-align:center;" placeholder="Other"></textarea>
          </div>
          <div style="text-align:center; margin-bottom:20px; margin-top:20px;">
          <a class="clean" id="first-week"></a>
             <select class="form-control" id="week-id">
             </select>  
          </div>
        </div>
        </div>
       <div id="addbutton" style="text-align:center;">
       </div>
      </div> 
     </div> 
   </div> 
</div>
</div> 
 
 
 
</div>
</div>

  
  
<script>  
$("div#subject-other-div").text("");
var type = ["國文","數學","英文","地理","歷史","公民","生物","化學","物理","地科","其他(請自填)"]

//自動選項
 for(var i =0;i<type.length;i++){
   $("div#subject").append("<input type='radio' id='sub-search' value='type[i]'>type[i]")
 } 
 
//搜尋科目
function searchSubDetail(){
 var query; 
 switch(input#sub-search.val){
             case "國文":
               query = scoreCollection.find({  Subject: type[0];  });
               $("#messageTop").append("<b>科目:&nbsp</b>type[0]")
               break;
             case "數學":
               query = scoreCollection.find({  Subject: type[1];  });
               $("#messageTop").append("<b>科目:&nbsp</b>type[1]")
               break;
             case "英文":
               query = scoreCollection.find({  Subject: type[2];  });
               $("#messageTop").append("<b>科目:&nbsp</b>type[2]")
               break;
             case "地理":
               query = scoreCollection.find({  Subject: type[3];  });
               $("#messageTop").append("<b>科目:&nbsp</b>type[3]")
               break;
             case "歷史":
               query = scoreCollection.find({  Subject: type[4];  });
               $("#messageTop").append("<b>科目:&nbsp</b>type[4]")
               break;
             case "公民":
               query = scoreCollection.find({  Subject: type[5];  });
               $("#messageTop").append("<b>科目:&nbsp</b>type[5]")
               break;
             case "生物":
               query = scoreCollection.find({  Subject: type[6];  });
               $("#messageTop").append("<b>科目:&nbsp</b>type[6]")
               break;
             case "化學":
               query = scoreCollection.find({  Subject: type[7];  });
               $("#messageTop").append("<b>科目:&nbsp</b>type[7]")
               break;
             case "物理":
               query = scoreCollection.find({  Subject: type[8];  });
               $("#messageTop").append("<b>科目:&nbsp</b>type[8]")
               break;
             case "地科":
               query = scoreCollection.find({  Subject: type[9];  });
               $("#messageTop").append("<b>科目:&nbsp</b>type[9]")
               break;
          }
 if(query.length!=0){
      $("#messageButton").text("");
      $("#subSearchtable tbody").text("");
     for(var i=0;i<query.length;i++){
         var num = i+1;
         var comment = "<tr><td>"+num+"</td><td>"+query[i].Score+"</td><td>"+query[i].Date+"</td><td><a id="+query[i]._id+" class='test' onclick='moredetails("+i+");'>更多</a></td><td><input type='button' class='btn btn-info btn-xs' id='changebtn' data-id='"+query[i]._id+"' onclick='changedata("+i+");' value='修改'>&nbsp<input type='button' id="+query[i]._id+" class='btn btn-danger btn-xs' onclick='deletescoredetail("+i+");' value='刪除'></td></tr>";
         $("table#subSearchtable tbody").append(comment);
     }
      $("div#select").hide();
      $("div#subSearchlist").show();
      $("#messageTop").text("");
   }else{
      $("#messageTop").text("");
      $("#messageButton").text("");
      $("table#subSearchtable tbody").text("");
      $("#messageButton").append("<b>無任何資料</b>");
   }  
} 
 
//更多
function moredetails(i){
var query;
  //國文
   if($("input#Chinese:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Chinese").val()
     });
   //數學
   }else if($("input#Math:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Math").val()
     });
   //英文
   }else if($("input#English:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#English").val()
     });
   //地理
   }else if($("input#Geography:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Geography").val()
     });
   //歷史
   }else if($("input#History:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#History").val()
     });
   //公民
   }else if($("input#Civics:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Civics").val()
     });
   //物理
   }else if($("input#Physical:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Physical").val()
     });
   //化學
   }else if($("input#Chemistry:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Chemistry").val()
     });
   //生物
   }else if($("input#Biological:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Biological").val()
     });
   //地科
   }else if($("input#EarthScience:checked").length!=0){
    query = scoreCollection.find({
      Subject: $("input#EarthScience").val()
     });
   };
   if(query.length!=0){
      $("p#information").text("");
      $("p#information").append("<p><b>分數:&nbsp</b>"+query[0].Score+"</p>"+"<p><b>日期:&nbsp</b>"+query[0].Date+"</p>"+"<p><b>其他:&nbsp</b>"+query[0].other+"</p>"+"<p><b>曜日:&nbsp</b>"+query[0].week+"</p>");
      $("#alert-information").modal();
   }
}
 
//刪除和修改
function deletescoredetail(i){
  var query;
  //國文
   if($("input#Chinese:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Chinese").val()
     });
   //數學
   }else if($("input#Math:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Math").val()
     });
   //英文
   }else if($("input#English:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#English").val()
     });
   //地理
   }else if($("input#Geography:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Geography").val()
     });
   //歷史
   }else if($("input#History:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#History").val()
     });
   //公民
   }else if($("input#Civics:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Civics").val()
     });
   //物理
   }else if($("input#Physical:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Physical").val()
     });
   //化學
   }else if($("input#Chemistry:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Chemistry").val()
     });
   //生物
   }else if($("input#Biological:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Biological").val()
     });
   //地科
   }else if($("input#EarthScience:checked").length!=0){
    query = scoreCollection.find({
      Subject: $("input#EarthScience").val()
     });
   };
  var r=confirm("確定要刪除嗎?")
  console.log(i);
  if (r==true){
    scoreCollection.remove({ _id: query[i]._id });
    scoreCollection.save();
    searchSubDetail();
  }else{
    alert("好的!不刪除!");
  }
 } 
 
 
//修改資料
function changedata(i){
     var query;
  //國文
   if($("input#Chinese:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Chinese").val()
     });
   //數學
   }else if($("input#Math:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Math").val()
     });
   //英文
   }else if($("input#English:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#English").val()
     });
   //地理
   }else if($("input#Geography:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Geography").val()
     });
   //歷史
   }else if($("input#History:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#History").val()
     });
   //公民
   }else if($("input#Civics:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Civics").val()
     });
   //物理
   }else if($("input#Physical:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Physical").val()
     });
   //化學
   }else if($("input#Chemistry:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Chemistry").val()
     });
   //生物
   }else if($("input#Biological:checked").length!=0){
     query = scoreCollection.find({
       Subject: $("input#Biological").val()
     });
   //地科
   }else if($("input#EarthScience:checked").length!=0){
    query = scoreCollection.find({
      Subject: $("input#EarthScience").val()
     });
   };
     var editid = query[i]._id
     var changedetail={
       _id: editid
     };
      $("a.clean").text("");
      $("div#addbutton").text("");
      $("div#modal-head-right").hide();
      $("div#modal-head-wrong").hide();
      $("a#first-subject").append("<b>原科目為&nbsp</b>"+query[0].Subject);
      $("a#first-score").append("<b>原分數為&nbsp</b>"+query[0].Score);
      $("a#first-date").append("<b>原日期為&nbsp</b>"+query[0].Date);
      $("a#first-other").append("<b>其他:&nbsp</b>"+query[0].other);
      $("a#first-week").append("<b>原本為&nbsp</b>"+query[0].week);
      $("div#addbutton").append("<button class='btn btn-info' onclick='changescore("+i+");'>Enter</button>"+"&nbsp"+"<button type='button' class='btn btn-danger' data-dismiss='modal'>Cancel</button>");
      $("div#most").show();
      $("#changemodal").modal();
};

 function changescore(i){
  var query;
  var editid = query[i]._id
  if($("select#subject :selected").val()!=="" || $("input#score-change").val()!==""){
  var editdata= {
  
    Subject: $("select#subject :selected").val(),
    Score: $("input#score-change").val(),
    Date: $("input#date-change").val(),
    other: $("textarea#other-change").val(),
    week: $("select#score-id-change :selected").val()
  
  }
  var r = confirm("再次確認:確定要更新嗎?")
        if(r){
          scoreCollection.updateById(editid,editdata);
          scoreCollection.save();
           $("select#subject").val("");
           $("input#score-change").val("");
           $("input#date-change").val("");
           $("textarea#other-change").val("");
           $("select#score-id-change").val("");
           $("div#most").hide();
          $("div#modal-head-right").show();
          showscore();
         
  }
 }else{
     $("div#modal-head-wrong").show();
 }
 } 
 
</script>  

  
  
  
  
  
  
</body>
</html> 
